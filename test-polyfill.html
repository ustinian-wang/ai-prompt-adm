<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyfill 测试页面</title>
</head>
<body>
    <h1>Polyfill 测试页面</h1>
    <div id="test-output"></div>
    
    <script>
        // 测试 require 函数是否正确定义
        console.log('测试开始...');
        
        if (typeof require === 'undefined') {
            console.log('require 函数未定义，正在设置 polyfill...');
            
            // 提供 require 函数的 polyfill
            window.require = function(module) {
                if (module === 'mutationobserver-shim') {
                    // 如果 MutationObserver 已经存在，直接返回
                    if (window.MutationObserver) {
                        console.log('MutationObserver 已存在，直接返回');
                        return window.MutationObserver;
                    }
                    
                    // 动态导入 mutationobserver-shim
                    return new Promise((resolve) => {
                        const script = document.createElement('script');
                        script.src = 'https://unpkg.com/mutationobserver-shim@0.3.7/dist/mutationobserver.min.js';
                        script.onload = function() {
                            console.log('mutationobserver-shim 加载成功');
                            resolve(window.MutationObserver);
                        };
                        script.onerror = function() {
                            console.warn('Failed to load mutationobserver-shim, using basic polyfill');
                            window.MutationObserver = window.MutationObserver || function() {
                                return {
                                    observe: function() {},
                                    disconnect: function() {}
                                };
                            };
                            resolve(window.MutationObserver);
                        };
                        document.head.appendChild(script);
                    });
                }
                throw new Error('Cannot find module: ' + module);
            };
            
            console.log('require polyfill 设置完成');
        } else {
            console.log('require 函数已存在');
        }
        
        // 测试 require 函数
        try {
            const result = require('mutationobserver-shim');
            console.log('require("mutationobserver-shim") 调用成功:', result);
            document.getElementById('test-output').innerHTML = '<p style="color: green;">✅ Polyfill 测试成功！</p>';
        } catch (error) {
            console.error('require 调用失败:', error);
            document.getElementById('test-output').innerHTML = '<p style="color: red;">❌ Polyfill 测试失败: ' + error.message + '</p>';
        }
        
        // 提供 global 对象
        if (typeof global === 'undefined') {
            window.global = window;
            console.log('global 对象设置完成');
        }
    </script>
</body>
</html>
