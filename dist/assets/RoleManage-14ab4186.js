import{b as i,m as l}from"./vendor-9a0f791b.js";import{n}from"./index-d6922ee5.js";import"./antd-9085d354.js";const d={name:"RoleManage",data(){return{modalVisible:!1,isEdit:!1,submitLoading:!1,roleForm:{name:"",description:"",permissions:[]},roleRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}],permissions:[{required:!0,message:"请选择权限",trigger:"change"}]}}},computed:{...i("system",["rolesList","loading"]),columns(){return[{title:"角色名称",dataIndex:"name",key:"name",width:150},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"权限",dataIndex:"permissions",key:"permissions",width:300,scopedSlots:{customRender:"permissions"}},{title:"用户数量",dataIndex:"userCount",key:"userCount",width:100,scopedSlots:{customRender:"userCount"}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",width:150,scopedSlots:{customRender:"action"}}]}},mounted(){this.getRolesList()},methods:{...l("system",["getRolesList","createRole","updateRole","deleteRole"]),showCreateModal(){this.isEdit=!1,this.roleForm={name:"",description:"",permissions:[]},this.modalVisible=!0},editRole(o){this.isEdit=!0,this.roleForm={id:o.id,name:o.name,description:o.description,permissions:[...o.permissions]},this.modalVisible=!0},async handleSubmit(){try{await this.$refs.roleForm.validate(),this.submitLoading=!0,this.isEdit?(await this.updateRole(this.roleForm),this.$message.success("更新角色成功")):(await this.createRole(this.roleForm),this.$message.success("创建角色成功")),this.modalVisible=!1,this.getRolesList()}catch(o){console.error("提交失败:",o)}finally{this.submitLoading=!1}},handleCancel(){this.modalVisible=!1,this.$refs.roleForm.resetFields()},async deleteRole(o){try{await this.deleteRole(o),this.$message.success("删除角色成功"),this.getRolesList()}catch{this.$message.error("删除失败")}}}};var c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"role-manage"},[t("div",{staticClass:"page-header"},[t("h2",[e._v("角色管理")]),t("a-button",{attrs:{type:"primary"},on:{click:e.showCreateModal}},[t("a-icon",{attrs:{type:"plus"}}),e._v(" 新建角色 ")],1)],1),t("a-table",{attrs:{columns:e.columns,"data-source":e.rolesList,loading:e.loading,"row-key":"id"},scopedSlots:e._u([{key:"permissions",fn:function(s){return[s&&s.includes("*")?t("a-tag",{attrs:{color:"red"}},[e._v("全部权限")]):e._l(s,function(a){return t("a-tag",{key:a,attrs:{color:"blue"}},[e._v(e._s(a))])})]}},{key:"userCount",fn:function(s){return[t("a-tag",{attrs:{color:"green"}},[e._v(e._s(s))])]}},{key:"action",fn:function(s,a){return[t("a-button",{attrs:{type:"link"},on:{click:function(r){return e.editRole(a)}}},[e._v("编辑")]),t("a-popconfirm",{attrs:{title:"确定要删除这个角色吗？"},on:{confirm:function(r){return e.deleteRole(a.id)}}},[t("a-button",{staticStyle:{color:"#ff4d4f"},attrs:{type:"link"}},[e._v("删除")])],1)]}}])}),t("a-modal",{attrs:{title:e.isEdit?"编辑角色":"新建角色",visible:e.modalVisible,"confirm-loading":e.submitLoading},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-form-model",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.roleRules,"label-col":{span:6},"wrapper-col":{span:16}}},[t("a-form-model-item",{attrs:{label:"角色名称",prop:"name"}},[t("a-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.roleForm.name,callback:function(s){e.$set(e.roleForm,"name",s)},expression:"roleForm.name"}})],1),t("a-form-model-item",{attrs:{label:"角色描述",prop:"description"}},[t("a-textarea",{attrs:{rows:4,placeholder:"请输入角色描述"},model:{value:e.roleForm.description,callback:function(s){e.$set(e.roleForm,"description",s)},expression:"roleForm.description"}})],1),t("a-form-model-item",{attrs:{label:"权限配置",prop:"permissions"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",placeholder:"请选择权限"},model:{value:e.roleForm.permissions,callback:function(s){e.$set(e.roleForm,"permissions",s)},expression:"roleForm.permissions"}},[t("a-select-option",{attrs:{value:"*"}},[e._v("全部权限")]),t("a-select-option",{attrs:{value:"works:read"}},[e._v("作品查看")]),t("a-select-option",{attrs:{value:"works:write"}},[e._v("作品编辑")]),t("a-select-option",{attrs:{value:"works:delete"}},[e._v("作品删除")]),t("a-select-option",{attrs:{value:"categories:read"}},[e._v("分类查看")]),t("a-select-option",{attrs:{value:"categories:write"}},[e._v("分类编辑")]),t("a-select-option",{attrs:{value:"users:read"}},[e._v("用户查看")]),t("a-select-option",{attrs:{value:"users:write"}},[e._v("用户编辑")]),t("a-select-option",{attrs:{value:"users:delete"}},[e._v("用户删除")]),t("a-select-option",{attrs:{value:"roles:read"}},[e._v("角色查看")]),t("a-select-option",{attrs:{value:"roles:write"}},[e._v("角色编辑")])],1)],1)],1)],1)],1)},m=[],u=n(d,c,m,!1,null,"7ca2d09a",null,null);const _=u.exports;export{_ as default};
