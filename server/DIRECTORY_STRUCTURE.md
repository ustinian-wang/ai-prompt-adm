# 后端项目目录结构规范

## 概述
本文档描述了后端项目的标准目录结构，用于规范文件读写操作和项目组织。

## 目录结构

```
server/
├── data/                    # 数据文件目录
│   ├── database/           # 文件数据库
│   │   ├── users.json     # 用户数据
│   │   ├── works.json     # 作品数据
│   │   └── categories.json # 分类数据
│   ├── cache/             # 缓存文件
│   └── logs/              # 日志文件
├── uploads/                # 文件上传目录
│   ├── images/            # 图片文件
│   ├── thumbnails/        # 缩略图
│   ├── documents/         # 文档文件
│   └── temp/              # 临时文件
├── config/                 # 配置文件
├── utils/                  # 工具文件
└── routes/                 # 路由文件
```

## 详细说明

### 1. 数据目录 (`data/`)

#### 1.1 数据库目录 (`data/database/`)
- **用途**: 存储JSON格式的文件数据库
- **文件类型**: `.json` 文件
- **命名规范**: 使用复数形式，如 `users.json`, `works.json`
- **权限**: 读写权限，应用启动时自动创建

#### 1.2 缓存目录 (`data/cache/`)
- **用途**: 存储临时缓存数据
- **文件类型**: `.cache` 文件
- **生命周期**: 自动过期清理，默认1小时
- **权限**: 读写权限，应用启动时自动创建

#### 1.3 日志目录 (`data/logs/`)
- **用途**: 存储应用日志文件
- **文件类型**: `.log` 文件
- **日志分类**:
  - `app.log`: 应用日志
  - `error.log`: 错误日志
  - `access.log`: 访问日志
- **权限**: 只写权限，应用启动时自动创建

### 2. 上传目录 (`uploads/`)

#### 2.1 图片目录 (`uploads/images/`)
- **用途**: 存储用户上传的图片文件
- **文件命名**: `userId_workId_imgId_timestamp.ext`
- **大小限制**: 10MB
- **支持格式**: JPG, PNG, GIF, WebP

#### 2.2 缩略图目录 (`uploads/thumbnails/`)
- **用途**: 存储图片的缩略图版本
- **生成方式**: 自动生成
- **命名规范**: 与原图保持一致

#### 2.3 文档目录 (`uploads/documents/`)
- **用途**: 存储文档文件
- **支持格式**: PDF, DOC, DOCX, TXT等
- **大小限制**: 根据业务需求配置

#### 2.4 临时目录 (`uploads/temp/`)
- **用途**: 存储临时上传的文件
- **生命周期**: 定期清理
- **权限**: 读写权限

### 3. 配置文件 (`config/`)

#### 3.1 路径配置 (`config/paths.js`)
- **用途**: 统一管理所有目录路径
- **导出**: `PATHS` 对象，包含所有路径常量
- **使用方式**: `import { PATHS } from '../config/paths.js'`

### 4. 工具文件 (`utils/`)

#### 4.1 文件数据库 (`utils/fileDb.js`)
- **用途**: 管理JSON文件数据库操作
- **功能**: 增删改查、数据初始化
- **支持**: 用户、作品、分类等数据

#### 4.2 日志工具 (`utils/logger.js`)
- **用途**: 统一日志记录和管理
- **功能**: 应用日志、错误日志、访问日志
- **特性**: 自动创建目录、日志轮转

#### 4.3 缓存工具 (`utils/cache.js`)
- **用途**: 管理内存和文件缓存
- **功能**: 设置、获取、删除、清理缓存
- **特性**: TTL支持、自动过期清理

## 使用规范

### 1. 文件操作
- 所有文件操作都应使用 `PATHS` 配置中的路径
- 文件读写前检查目录是否存在
- 使用适当的错误处理机制

### 2. 数据持久化
- 重要数据使用文件数据库存储
- 临时数据使用缓存系统
- 定期备份重要数据文件

### 3. 日志记录
- 使用统一的日志工具记录信息
- 错误日志包含完整的错误堆栈
- 访问日志记录请求详情

### 4. 缓存管理
- 合理设置缓存TTL
- 定期清理过期缓存
- 避免缓存敏感信息

## 初始化流程

应用启动时会自动执行以下初始化步骤：

1. 创建必要的目录结构
2. 初始化默认用户数据
3. 初始化默认分类数据
4. 初始化默认作品数据
5. 设置日志系统
6. 配置缓存系统

## 注意事项

1. **权限管理**: 确保目录有适当的读写权限
2. **磁盘空间**: 定期监控磁盘使用情况
3. **数据备份**: 重要数据定期备份
4. **安全考虑**: 上传文件进行类型和大小验证
5. **性能优化**: 合理使用缓存，避免频繁文件IO

## 扩展建议

1. 考虑添加数据库迁移工具
2. 实现文件压缩和优化
3. 添加文件去重和版本控制
4. 集成云存储服务
5. 实现分布式文件存储
