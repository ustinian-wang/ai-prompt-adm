import{b as r,m as n}from"./vendor-9a0f791b.js";import{n as l}from"./index-be2a32b1.js";import"./antd-9845fd40.js";const c={name:"RoleManage",data(){return{modalVisible:!1,isEdit:!1,submitLoading:!1,roleForm:{name:"",description:"",permissions:[],status:"active"},roleRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}],permissions:[{required:!0,message:"请选择权限",trigger:"change"}]},indeterminate:!1,checkAll:!1}},computed:{...r("system",["rolesList","loading","pagination"]),columns(){return[{title:"角色名称",dataIndex:"name",key:"name",width:150},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"权限",dataIndex:"permissions",key:"permissions",width:300,scopedSlots:{customRender:"permissions"}},{title:"用户数量",dataIndex:"userCount",key:"userCount",width:100,scopedSlots:{customRender:"userCount"}},{title:"状态",dataIndex:"status",key:"status",width:100,scopedSlots:{customRender:"status"}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",width:150,scopedSlots:{customRender:"action"}}]}},mounted(){this.getRolesList()},methods:{...n("system",["getRolesList","createRole","updateRole","deleteRole"]),showCreateModal(){this.isEdit=!1,this.roleForm={name:"",description:"",permissions:[],status:"active"},this.indeterminate=!1,this.checkAll=!1,this.modalVisible=!0},editRole(s){this.isEdit=!0,this.roleForm={id:s.id,name:s.name,description:s.description,permissions:[...s.permissions],status:s.status},this.indeterminate=!1,this.checkAll=!1,this.modalVisible=!0},viewRole(s){this.isEdit=!1,this.roleForm={id:s.id,name:s.name,description:s.description,permissions:[...s.permissions],status:s.status},this.indeterminate=!1,this.checkAll=!1,this.modalVisible=!0},async handleSubmit(){try{await this.$refs.roleForm.validate(),this.submitLoading=!0,this.isEdit?(await this.updateRole(this.roleForm),this.$message.success("更新角色成功")):(await this.createRole(this.roleForm),this.$message.success("创建角色成功")),this.modalVisible=!1,this.getRolesList()}catch(s){console.error("提交失败:",s)}finally{this.submitLoading=!1}},handleCancel(){this.modalVisible=!1,this.$refs.roleForm.resetFields()},async deleteRole(s){try{await this.deleteRole(s),this.$message.success("删除角色成功"),this.getRolesList()}catch{this.$message.error("删除失败")}},onCheckAllChange(s){this.checkAll=s.target.checked,this.indeterminate=!1,this.roleForm.permissions=s.target.checked?["*"]:[]},onPermissionChange(s){const e=s.length;this.checkAll=e===this.permissionsOptions.length,this.indeterminate=e>0&&e<this.permissionsOptions.length}}};var m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"role-manage"},[t("div",{staticClass:"page-header"},[e._m(0),t("a-button",{attrs:{type:"primary",size:"large"},on:{click:e.showCreateModal}},[t("a-icon",{attrs:{type:"plus"}}),e._v(" 新建角色 ")],1)],1),t("div",{staticClass:"content-wrapper"},[t("a-card",{staticClass:"table-card",attrs:{bordered:!1}},[t("a-table",{attrs:{columns:e.columns,"data-source":e.rolesList,loading:e.loading,"row-key":"id",pagination:e.pagination,size:"middle"},scopedSlots:e._u([{key:"permissions",fn:function(a){return[t("div",{staticClass:"permissions-tags"},[a&&a.includes("*")?t("a-tag",{attrs:{color:"red"}},[t("a-icon",{attrs:{type:"safety-certificate"}}),e._v(" 全部权限 ")],1):e._l(a,function(i){return t("a-tag",{key:i,attrs:{color:"blue"}},[e._v(" "+e._s(i)+" ")])})],2)]}},{key:"userCount",fn:function(a){return[t("a-badge",{attrs:{count:a,"number-style":{backgroundColor:"#52c41a"}}})]}},{key:"status",fn:function(a){return[t("a-tag",{attrs:{color:a==="active"?"green":"default"}},[e._v(" "+e._s(a==="active"?"启用":"禁用")+" ")])]}},{key:"action",fn:function(a,i){return[t("div",{staticClass:"action-buttons"},[t("a-button",{staticClass:"action-btn",attrs:{type:"link"},on:{click:function(o){return e.editRole(i)}}},[t("a-icon",{attrs:{type:"edit"}}),e._v(" 编辑 ")],1),t("a-button",{staticClass:"action-btn",attrs:{type:"link"},on:{click:function(o){return e.viewRole(i)}}},[t("a-icon",{attrs:{type:"eye"}}),e._v(" 查看 ")],1),t("a-popconfirm",{attrs:{title:"确定要删除这个角色吗？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(o){return e.deleteRole(i.id)}}},[t("a-button",{staticClass:"action-btn delete-btn",attrs:{type:"link"}},[t("a-icon",{attrs:{type:"delete"}}),e._v(" 删除 ")],1)],1)],1)]}}])})],1)],1),t("a-modal",{staticClass:"role-modal",attrs:{title:e.isEdit?"编辑角色":"新建角色",visible:e.modalVisible,"confirm-loading":e.submitLoading,width:600},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-form-model",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.roleRules,"label-col":{span:6},"wrapper-col":{span:18},layout:"horizontal"}},[t("a-form-model-item",{attrs:{label:"角色名称",prop:"name"}},[t("a-input",{attrs:{placeholder:"请输入角色名称",size:"large"},model:{value:e.roleForm.name,callback:function(a){e.$set(e.roleForm,"name",a)},expression:"roleForm.name"}})],1),t("a-form-model-item",{attrs:{label:"角色描述",prop:"description"}},[t("a-textarea",{attrs:{rows:4,placeholder:"请输入角色描述",size:"large"},model:{value:e.roleForm.description,callback:function(a){e.$set(e.roleForm,"description",a)},expression:"roleForm.description"}})],1),t("a-form-model-item",{attrs:{label:"角色状态",prop:"status"}},[t("a-radio-group",{attrs:{size:"large"},model:{value:e.roleForm.status,callback:function(a){e.$set(e.roleForm,"status",a)},expression:"roleForm.status"}},[t("a-radio",{attrs:{value:"active"}},[e._v("启用")]),t("a-radio",{attrs:{value:"inactive"}},[e._v("禁用")])],1)],1),t("a-form-model-item",{attrs:{label:"权限配置",prop:"permissions"}},[t("div",{staticClass:"permissions-section"},[t("div",{staticClass:"permissions-header"},[t("a-checkbox",{attrs:{indeterminate:e.indeterminate,checked:e.checkAll},on:{change:e.onCheckAllChange}},[e._v(" 全选 ")])],1),t("a-divider",{staticStyle:{margin:"12px 0"}}),t("div",{staticClass:"permissions-groups"},[t("div",{staticClass:"permission-group"},[t("h4",[e._v("作品管理")]),t("a-checkbox-group",{on:{change:e.onPermissionChange},model:{value:e.roleForm.permissions,callback:function(a){e.$set(e.roleForm,"permissions",a)},expression:"roleForm.permissions"}},[t("a-checkbox",{attrs:{value:"works:read"}},[e._v("作品查看")]),t("a-checkbox",{attrs:{value:"works:write"}},[e._v("作品编辑")]),t("a-checkbox",{attrs:{value:"works:delete"}},[e._v("作品删除")]),t("a-checkbox",{attrs:{value:"works:publish"}},[e._v("作品发布")])],1)],1),t("div",{staticClass:"permission-group"},[t("h4",[e._v("分类管理")]),t("a-checkbox-group",{on:{change:e.onPermissionChange},model:{value:e.roleForm.permissions,callback:function(a){e.$set(e.roleForm,"permissions",a)},expression:"roleForm.permissions"}},[t("a-checkbox",{attrs:{value:"categories:read"}},[e._v("分类查看")]),t("a-checkbox",{attrs:{value:"categories:write"}},[e._v("分类编辑")]),t("a-checkbox",{attrs:{value:"categories:delete"}},[e._v("分类删除")])],1)],1),t("div",{staticClass:"permission-group"},[t("h4",[e._v("用户管理")]),t("a-checkbox-group",{on:{change:e.onPermissionChange},model:{value:e.roleForm.permissions,callback:function(a){e.$set(e.roleForm,"permissions",a)},expression:"roleForm.permissions"}},[t("a-checkbox",{attrs:{value:"users:read"}},[e._v("用户查看")]),t("a-checkbox",{attrs:{value:"users:write"}},[e._v("用户编辑")]),t("a-checkbox",{attrs:{value:"users:delete"}},[e._v("用户删除")])],1)],1),t("div",{staticClass:"permission-group"},[t("h4",[e._v("系统管理")]),t("a-checkbox-group",{on:{change:e.onPermissionChange},model:{value:e.roleForm.permissions,callback:function(a){e.$set(e.roleForm,"permissions",a)},expression:"roleForm.permissions"}},[t("a-checkbox",{attrs:{value:"roles:read"}},[e._v("角色查看")]),t("a-checkbox",{attrs:{value:"roles:write"}},[e._v("角色编辑")]),t("a-checkbox",{attrs:{value:"system:config"}},[e._v("系统配置")])],1)],1)])],1)])],1)],1)],1)},d=[function(){var s=this,e=s._self._c;return e("div",{staticClass:"header-content"},[e("h1",[s._v("角色管理")]),e("p",[s._v("管理系统角色和权限配置")])])}],u=l(c,m,d,!1,null,"7af7fbf1",null,null);const g=u.exports;export{g as default};
