import{b as n,m as l}from"./vendor-9a0f791b.js";import{B as c}from"./BackButton-d942c913.js";import{n as d}from"./index-be2a32b1.js";import"./antd-9845fd40.js";const u="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=3dfe1462-813c-4c48-845d-8e5bf7cfd9e",h=async(r,t="text",e={})=>{try{const s={msgtype:t,[t]:t==="text"?{content:r}:r},o=await(await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();return o.errcode===0?(console.log("企业微信通知发送成功"),!0):(console.error("企业微信通知发送失败:",o.errmsg),!1)}catch(s){return console.error("企业微信通知发送异常:",s),!1}},m=r=>h(r,"text");const k={name:"WorkList",data(){return{modalVisible:!1,isEdit:!1,submitLoading:!1,exporting:!1,routeWatcher:null,searchForm:{work_name:"",work_type:"",category:null,work_status:null},workForm:{work_name:"",work_type:"",work_name:"",tags:[],image:""},workRules:{work_name:[{required:!0,message:"请输入作品名称",trigger:"blur"}],work_type:[{required:!0,message:"请选择作品类型",trigger:"change"}],work_name:[{required:!0,message:"请输入作品描述",trigger:"blur"}]},rowSelection:{onChange:(r,t)=>{this.selectedWorks=t},getCheckboxProps:r=>({disabled:r.work_status==="archived",name:r.id})},selectedWorks:[],categoryTree:[{title:"AI创作",value:"ai_creation",key:"ai_creation",children:[{title:"AI绘画",value:"ai_painting",key:"ai_painting"},{title:"AI写作",value:"ai_writing",key:"ai_writing"},{title:"AI编程",value:"ai_programming",key:"ai_programming"}]},{title:"UI设计",value:"ui_design",key:"ui_design",children:[{title:"图标设计",value:"icon_design",key:"icon_design"},{title:"界面设计",value:"interface_design",key:"interface_design"}]},{title:"3D设计",value:"3d_design",key:"3d_design",children:[{title:"3D模型",value:"3d_model",key:"3d_model"},{title:"3D动画",value:"3d_animation",key:"3d_animation"}]},{title:"插画设计",value:"illustration_design",key:"illustration_design",children:[{title:"手绘插画",value:"hand_illustration",key:"hand_illustration"},{title:"数字插画",value:"digital_illustration",key:"digital_illustration"}]}]}},components:{BackButton:c},computed:{...n("works",["worksList","loading","pagination"]),columns(){return[{title:"图片",dataIndex:"work_img_path",key:"work_img_path",width:80,scopedSlots:{customRender:"image"}},{title:"作品信息",dataIndex:"work_name",key:"work_name"},{title:"作品信息",dataIndex:"work_desc",key:"work_desc",width:250,scopedSlots:{customRender:"workInfo"}},{title:"类型",dataIndex:"work_type",key:"work_type",width:120},{title:"标签",dataIndex:"tags",key:"tags",width:200,scopedSlots:{customRender:"tags"}},{title:"状态",dataIndex:"work_status",key:"work_status",width:100,scopedSlots:{customRender:"work_status"}},{title:"操作",key:"action",width:200,scopedSlots:{customRender:"action"}}]}},mounted(){this.getWorksList(),this.routeWatcher=this.$watch(()=>this.$route,(r,t)=>{t.name&&t.name!=="WorkList"&&r.name==="WorkList"&&this.getWorksList()})},beforeRouteEnter(r,t,e){e(s=>{t.name&&t.name!=="WorkList"&&s.getWorksList()})},activated(){this.getWorksList()},beforeDestroy(){this.routeWatcher&&this.routeWatcher()},methods:{...l("works",["getWorksList","createWork","updateWork","deleteWork"]),handleSearch(){this.getCurrWorkList()},getCurrWorkList(){this.getWorksList(this.searchForm)},handleReset(){this.searchForm={work_name:"",work_type:"",category:null,work_status:null},this.getCurrWorkList()},async handleExport(){if(!this.exporting)try{this.exporting=!0,this.$message.loading("正在准备导出数据...",0);let r=this.worksList||[];if(r.length===0&&(this.$message.destroy(),this.$message.loading("正在获取数据...",0),await this.getCurrWorkList(),r=this.worksList||[]),r.length===0){this.$message.destroy(),this.$message.warning("没有数据可导出");return}this.$message.destroy(),this.$message.loading(`正在处理 ${r.length} 条数据...`,0);const t=this.generateExportFilename(),e=["作品名称","作品类型","作品描述","标签","状态","创建时间","作者"],s=this.convertToCSV(r,e);this.$message.destroy(),this.$message.loading("正在生成文件...",0),this.downloadCSV(s,t),this.$message.destroy(),this.$message.success(`导出成功，共导出 ${r.length} 条记录`);try{await m(`作品列表导出完成
导出数量: ${r.length}
文件名: ${t}
时间: ${new Date().toLocaleString()}`)}catch(a){console.warn("企业微信通知发送失败:",a)}}catch(r){this.$message.destroy(),console.error("导出失败:",r),this.$message.error("导出失败")}finally{this.exporting=!1}},handleBatchOperation(){console.log("批量操作功能待实现")},viewWork(r){console.log("查看作品详情:",r),this.$router.push({name:"WorkDetail",params:{id:r.work_id}})},addWork(){this.$router.push({name:"WorkDetail"})},editWork(r){this.isEdit=!0,this.workForm={work_id:r.work_id,work_name:r.work_name,work_type:r.work_type,work_name:r.work_name,work_tag_list:[...r.work_tag_list],work_img_path:r.work_img_path},this.modalVisible=!0},async duplicateWork(r){try{await this.createWork(this.worksList.find(t=>t.id===r)),this.$message.success("作品复制成功"),this.getCurrWorkList()}catch{this.$message.error("作品复制失败")}},async shareWork(r){try{const t=this.worksList.find(e=>e.id===r);this.$message.success(`作品 "${t.work_name}" 已分享`)}catch{this.$message.error("分享失败")}},async archiveWork(r){try{const t=this.worksList.find(e=>e.id===r);await this.updateWork({...t,work_status:"archived"}),this.$message.success("作品已归档"),this.getCurrWorkList()}catch{this.$message.error("归档失败")}},async togglework_status(r){try{const t=r.work_status==="展示"?"隐藏":"展示";await this.updateWork({...r,work_status:t}),this.$message.success(`状态已${t==="展示"?"展示":"隐藏"}`),this.getCurrWorkList()}catch{this.$message.error("状态更新失败")}},async handleDeleteWork(r,t){console.log("[handleDeleteWork] record",t);try{await this.deleteWork(r),this.$message.success("删除作品成功"),this.getCurrWorkList()}catch(e){console.warn(e),this.$message.error("删除失败")}},async handleSubmit(){try{await this.$refs.workForm.validate(),this.submitLoading=!0,this.isEdit?(await this.updateWork(this.workForm),this.$message.success("更新作品成功")):(await this.createWork(this.workForm),this.$message.success("创建作品成功")),this.modalVisible=!1,this.getCurrWorkList()}catch(r){console.error("提交失败:",r)}finally{this.submitLoading=!1}},handleCancel(){this.modalVisible=!1,this.$refs.workForm.resetFields()},beforeUpload(r){const t=r.type==="image/jpeg"||r.type==="image/png";t||this.$message.error("只能上传 JPG/PNG 格式的图片!");const e=r.size/1024/1024<2;return e||this.$message.error("图片大小不能超过 2MB!"),t&&e},handleImageChange(r){r.file.work_status==="done"&&(this.workForm.work_img_path=r.file.response.url||URL.createObjectURL(r.file.originFileObj))},formatDate(r){if(!r)return"";const t=new Date(r),e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${e}-${s}-${a} ${o}:${i}`},getwork_statusColor(r){switch(r){case"published":return"green";case"archived":return"gray";default:return"blue"}},getwork_statusIcon(r){switch(r){case"published":return"check-circle";case"archived":return"inbox";default:return"clock-circle"}},getwork_statusText(r){switch(r){case"published":return"已发布";case"archived":return"已归档";default:return"草稿"}},convertToCSV(r,t){let e="\uFEFF";return e+=t.join(",")+`
`,r.forEach(s=>{const a=[this.escapeCSVField(s.work_name||""),this.escapeCSVField(s.work_type||""),this.escapeCSVField(s.work_desc||""),this.escapeCSVField(this.formatTagsForCSV(s.work_tag_list||[])),this.escapeCSVField(this.getwork_statusText(s.work_status||"")),this.escapeCSVField(this.formatDate(s.work_create_at||"")),this.escapeCSVField(s.author||"")];e+=a.join(",")+`
`}),e},escapeCSVField(r){if(r==null)return"";const t=String(r);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t},formatTagsForCSV(r){return Array.isArray(r)?r.join("; "):""},formatDateForFileName(r){const t=r.getFullYear(),e=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0"),a=String(r.getHours()).padStart(2,"0"),o=String(r.getMinutes()).padStart(2,"0");return`${t}${e}${s}_${a}${o}`},generateExportFilename(){let t=`作品列表_${this.formatDateForFileName(new Date)}`;const e=[];return this.searchForm.work_name&&e.push(`名称_${this.searchForm.work_name}`),this.searchForm.work_type&&e.push(`类型_${this.searchForm.work_type}`),this.searchForm.category&&e.push(`分类_${this.searchForm.category}`),this.searchForm.work_status&&e.push(`状态_${this.searchForm.work_status}`),e.length>0&&(t+=`_筛选_${e.join("_")}`),`${t}.csv`},downloadCSV(r,t){const e=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(s.download!==void 0){const a=URL.createObjectURL(e);s.setAttribute("href",a),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}else window.open("data:text/csv;charset=utf-8,"+encodeURIComponent(r))}}};var g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"work-list"},[e("BackButton",{attrs:{text:"返回首页",to:"/works"}}),e("div",{staticClass:"page-header"},[t._m(0),e("div",{staticClass:"header-actions"},[e("a-button",{attrs:{type:"primary",size:"large"},on:{click:t.addWork}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 新增作品 ")],1),e("a-button",{staticStyle:{"margin-left":"8px"},attrs:{size:"large"},on:{click:t.handleBatchOperation}},[e("a-icon",{attrs:{type:"tool"}}),t._v(" 批量操作 ")],1)],1)]),e("a-card",{staticClass:"search-card",attrs:{bordered:!1}},[e("a-form",{attrs:{layout:"inline",form:t.searchForm}},[e("a-row",{staticStyle:{width:"100%"},attrs:{gutter:16}},[e("a-form-item",{attrs:{label:"作品名称"}},[e("a-input",{attrs:{placeholder:"作品名称","allow-clear":"",size:"large"},model:{value:t.searchForm.work_name,callback:function(s){t.$set(t.searchForm,"work_name",s)},expression:"searchForm.work_name"}},[e("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),e("a-form-item",{attrs:{label:"作品类型"}},[e("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择类型","allow-clear":"",size:"large"},model:{value:t.searchForm.work_type,callback:function(s){t.$set(t.searchForm,"work_type",s)},expression:"searchForm.work_type"}},[e("a-select-option",{attrs:{value:"UI设计"}},[t._v("UI设计")]),e("a-select-option",{attrs:{value:"3D设计"}},[t._v("3D设计")]),e("a-select-option",{attrs:{value:"图标设计"}},[t._v("图标设计")]),e("a-select-option",{attrs:{value:"插画设计"}},[t._v("插画设计")]),e("a-select-option",{attrs:{value:"AI写作"}},[t._v("AI写作")]),e("a-select-option",{attrs:{value:"AI编程"}},[t._v("AI编程")])],1)],1),e("a-form-item",[e("a-button",{attrs:{type:"primary",size:"large"},on:{click:t.handleSearch}},[e("a-icon",{attrs:{type:"search"}}),t._v(" 搜索 ")],1),e("a-button",{staticStyle:{"margin-left":"8px"},attrs:{size:"large"},on:{click:t.handleReset}},[e("a-icon",{attrs:{type:"reload"}}),t._v(" 重置 ")],1),e("a-button",{staticStyle:{"margin-left":"8px"},attrs:{size:"large",loading:t.exporting,disabled:!t.worksList||t.worksList.length===0},on:{click:t.handleExport}},[e("a-icon",{attrs:{type:"download"}}),t._v(" 导出CSV ")],1)],1)],1)],1)],1),e("a-card",{staticClass:"table-card",attrs:{bordered:!1}},[e("a-table",{attrs:{columns:t.columns,"data-source":t.worksList,loading:t.loading,pagination:t.pagination,"row-key":"id",size:"middle","row-selection":t.rowSelection},scopedSlots:t._u([{key:"image",fn:function(s){return[e("div",{staticClass:"work-image"},[s.image?e("img",{staticClass:"work-thumbnail",attrs:{src:s.image,alt:s.work_name}}):e("div",{staticClass:"image-placeholder"},[e("a-icon",{attrs:{type:"picture"}})],1)])]}},{key:"workInfo",fn:function(s){return[e("div",{staticClass:"work-info"},[e("div",{staticClass:"work-title"},[t._v(t._s(s.work_name))]),e("div",{staticClass:"work-meta"},[e("span",{staticClass:"work-author"},[t._v("作者: "+t._s(s.author))]),e("span",{staticClass:"work-date"},[t._v(t._s(t.formatDate(s.work_create_at)))])])])]}},{key:"tags",fn:function(s){return[e("div",{staticClass:"work-tags"},t._l(s,function(a){return e("a-tag",{key:a,attrs:{color:"blue"}},[t._v(" "+t._s(a)+" ")])}),1)]}},{key:"work_status",fn:function(s){return[e("a-tag",{attrs:{color:t.getwork_statusColor(s)}},[e("a-icon",{attrs:{type:t.getwork_statusIcon(s)}}),t._v(" "+t._s(t.getwork_statusText(s))+" ")],1)]}},{key:"action",fn:function(s,a){return[e("div",{staticClass:"action-buttons"},[e("a-button",{staticClass:"action-btn",attrs:{type:"link"},on:{click:function(o){return t.viewWork(a)}}},[e("a-icon",{attrs:{type:"eye"}}),t._v(" 编辑 ")],1),e("a-popconfirm",{attrs:{title:"确定要删除这个作品吗？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(o){return t.handleDeleteWork(a.work_id,a)}}},[e("a-button",{staticClass:"action-btn delete-btn",attrs:{type:"link"}},[e("a-icon",{attrs:{type:"delete"}}),t._v(" 删除 ")],1)],1)],1)]}}])})],1),e("a-modal",{attrs:{title:t.isEdit?"编辑作品":"新增作品",visible:t.modalVisible,"confirm-loading":t.submitLoading,width:"600px"},on:{ok:t.handleSubmit,cancel:t.handleCancel}},[e("a-form-model",{ref:"workForm",attrs:{model:t.workForm,rules:t.workRules,"label-col":{span:6},"wrapper-col":{span:16}}},[e("a-form-model-item",{attrs:{label:"作品名称",prop:"work_name"}},[e("a-input",{attrs:{placeholder:"请输入作品名称"},model:{value:t.workForm.work_name,callback:function(s){t.$set(t.workForm,"work_name",s)},expression:"workForm.work_name"}})],1),e("a-form-model-item",{attrs:{label:"作品类型",prop:"work_type"}},[e("a-select",{attrs:{placeholder:"请选择作品类型"},model:{value:t.workForm.work_type,callback:function(s){t.$set(t.workForm,"work_type",s)},expression:"workForm.work_type"}},[e("a-select-option",{attrs:{value:"UI设计"}},[t._v("UI设计")]),e("a-select-option",{attrs:{value:"3D设计"}},[t._v("3D设计")]),e("a-select-option",{attrs:{value:"图标设计"}},[t._v("图标设计")]),e("a-select-option",{attrs:{value:"插画设计"}},[t._v("插画设计")])],1)],1),e("a-form-model-item",{attrs:{label:"作品描述",prop:"work_name"}},[e("a-textarea",{attrs:{rows:4,placeholder:"请输入作品描述"},model:{value:t.workForm.work_name,callback:function(s){t.$set(t.workForm,"work_name",s)},expression:"workForm.work_name"}})],1),e("a-form-model-item",{attrs:{label:"作品标签"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{mode:"tags",placeholder:"请输入标签，按回车确认"},model:{value:t.workForm.tags,callback:function(s){t.$set(t.workForm,"tags",s)},expression:"workForm.tags"}})],1),e("a-form-model-item",{attrs:{label:"作品图片"}},[e("a-upload",{staticClass:"work-uploader",attrs:{name:"file","list-type":"picture-card","show-upload-list":!1,"before-upload":t.beforeUpload},on:{change:t.handleImageChange}},[t.workForm.work_img_path?e("img",{attrs:{src:t.workForm.work_img_path,alt:"作品图片"}}):e("div",[e("a-icon",{attrs:{type:"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v("上传图片")])],1)])],1)],1)],1)],1)},p=[function(){var r=this,t=r._self._c;return t("div",{staticClass:"header-content"},[t("h1",[r._v("作品管理")]),t("p",[r._v("管理您的AI作品，组织内容结构")])])}],_=d(k,g,p,!1,null,"22a4c2c5",null,null);const b=_.exports;export{b as default};
